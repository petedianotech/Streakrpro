{
  "entities": {
    "LeaderboardEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LeaderboardEntry",
      "type": "object",
      "description": "Represents a single entry in the global leaderboard.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the leaderboard entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User entity. (Relationship: User 1:N LeaderboardEntry)"
        },
        "score": {
          "type": "number",
          "description": "The user's score for this leaderboard entry."
        },
        "streak": {
          "type": "number",
          "description": "The user's streak for this leaderboard entry."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp when the leaderboard entry was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "score",
        "streak",
        "timestamp"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "username": {
          "type": "string",
          "description": "The user's username."
        },
        "dailyChallengeCompletions": {
          "type": "array",
          "description": "List of daily challenge completions per user",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "username"
      ]
    },
    "DailyChallenge": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DailyChallenge",
      "type": "object",
      "description": "Represents a daily challenge in the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the daily challenge."
        },
        "date": {
          "type": "string",
          "description": "The date for which the daily challenge is active.",
          "format": "date"
        },
        "description": {
          "type": "string",
          "description": "The description of the daily challenge."
        },
        "reward": {
          "type": "string",
          "description": "The reward for completing the daily challenge."
        }
      },
      "required": [
        "id",
        "date",
        "description",
        "reward"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/leaderboard/{leaderboardEntryId}",
        "definition": {
          "entityName": "LeaderboardEntry",
          "schema": {
            "$ref": "#/backend/entities/LeaderboardEntry"
          },
          "description": "Represents a single entry in the global leaderboard. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "leaderboardEntryId",
              "description": "Unique identifier for the leaderboard entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Represents a user of the application. Contains user profile information and an array of daily challenge completions.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/daily_challenges/{dailyChallengeId}",
        "definition": {
          "entityName": "DailyChallenge",
          "schema": {
            "$ref": "#/backend/entities/DailyChallenge"
          },
          "description": "Represents a daily challenge in the application.",
          "params": [
            {
              "name": "dailyChallengeId",
              "description": "Unique identifier for the daily challenge."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the core features of the Streakrpro app, focusing on leaderboards, daily challenges, and user data, while adhering to the principles of Authorization Independence, Clarity of Intent, and DBAC.  The structure uses path-based ownership for user-specific data and a global collection for the leaderboard. Daily challenges are stored in a dedicated collection, allowing for easy querying and management.\n\n*   **Authorization Independence:** User-specific data (e.g., `dailyChallengeCompletions`) is stored under the `/users/{userId}` path, ensuring clear ownership. Leaderboard entries include the `userId`, eliminating the need for `get()` calls in security rules to verify ownership. This also applies to daily challenge completions. The denormalization strategy avoids hierarchical authorization dependencies, enabling atomic operations.\n*   **Clarity of Intent:** The structure clearly separates user data, leaderboard data, and daily challenge data into distinct collections.  The naming conventions are explicit (e.g., `dailyChallengeCompletions`), making the purpose of each collection and field clear.\n*   **QAPs (Rules are not Filters):** The structure supports secure `list` operations.  Listing leaderboard entries does not require filtering based on user roles or permissions, as it's a global collection. Listing daily challenges is also straightforward.  User-specific data is accessed via path-based ownership, ensuring that only the user can access their own data.\n\n*   **Leaderboard**: Leaderboard entries are stored in a global collection (`/leaderboard`). To support QAPs and denormalization, each entry contains the `userId`.\n*   **User Data**: Each user's data, including `dailyChallengeCompletions`, is stored under the `/users/{userId}` path. This ensures clear ownership and simplifies security rules.\n*   **Daily Challenges**: Daily challenges are stored in the `/daily_challenges` collection. This allows for easy querying and management of daily challenges.\n\nThis design promotes security, scalability, and debuggability, aligning with the core design principles and strategy mandates."
  }
}